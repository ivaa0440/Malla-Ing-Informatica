<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Malla Curricular Mejorada</title>
  <style>
    body {
      background-color: #111;
      color: #fff;
      font-family: sans-serif;
      margin: 0;
      padding: 20px;
    }
    h1 {
      text-align: center;
      margin-bottom: 30px;
    }
    .year-container {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-bottom: 40px;
      flex-wrap: nowrap;
      overflow-x: auto;
      padding-bottom: 10px;
    }
    .cuatrimestre-col {
      background-color: #222;
      border-radius: 10px;
      padding: 10px;
      min-width: 180px;
      flex-shrink: 0;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }
    .cuatrimestre-col h3 {
      text-align: center;
      margin: 0 0 10px;
      font-weight: bold;
      font-size: 1.1rem;
      border-bottom: 1px solid #555;
      padding-bottom: 5px;
    }
    .subject {
      padding: 8px 10px;
      border-radius: 10px;
      font-size: 13px;
      cursor: pointer;
      border: 1px solid #444;
      user-select: none;
      transition: background-color 0.3s;
      white-space: normal;
      line-height: 1.2;
      text-align: center;
    }
    .aprobada {
      background-color: #2ecc71;
      color: #111;
      font-weight: bold;
    }
    .disponible {
      background-color: #777;
      color: #fff;
    }
    .bloqueada {
      background-color: #222; /* más oscuro para mejor contraste */
      color: #bbb;
      cursor: not-allowed;
    }
    .subject small {
      display: block;
      opacity: 0.7;
      font-size: 11px;
      margin-top: 3px;
      color: #ccc;
    }
    #resetButton {
      background-color: #e74c3c;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      display: block;
      margin: 0 auto 40px;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular Mejorada - Ingeniería en Informática (UNLaM)</h1>
  <button id="resetButton" onclick="reiniciarMalla()">Reiniciar Malla</button>

  <div id="year-1" class="year-container"></div>

  <script>
    // Las materias para 1er año, organizadas por cuatrimestres (I y II)
    const materias1erAnio = {
      "I": [
        { codigo: "3621", nombre: "Matemática Discreta", correlativas: [] },
        { codigo: "3622", nombre: "Análisis Matemático I", correlativas: [] },
        { codigo: "3623", nombre: "Programación Inicial", correlativas: [] },
        { codigo: "3624", nombre: "Introducción a los Sistemas de Información", correlativas: [] },
        { codigo: "3625", nombre: "Sistemas de Numeración", correlativas: [] },
        { codigo: "3626", nombre: "Principios de Calidad de Software", correlativas: [] }
      ],
      "II": [
        { codigo: "3627", nombre: "Álgebra y Geometría Analítica I", correlativas: ["3622"] },
        { codigo: "3628", nombre: "Física I", correlativas: ["3622"] },
        { codigo: "3629", nombre: "Programación Estructurada Básica", correlativas: ["3623","3625"] },
        { codigo: "3630", nombre: "Introducción a la Gestión de Proyectos", correlativas: ["3624"] },
        { codigo: "3631", nombre: "Fundamentos de Sistemas Embebidos", correlativas: ["3625"] },
        { codigo: "3632", nombre: "Introducción a los Proyectos Informáticos", correlativas: ["3626"] }
      ]
    };

    let materiasAprobadas = JSON.parse(localStorage.getItem("materiasAprobadas")) || [];

    function crearColumna(cuatrimestre, materias) {
      const col = document.createElement("div");
      col.className = "cuatrimestre-col";
      col.innerHTML = `<h3>Cuatrimestre ${cuatrimestre}</h3>`;
      materias.forEach(m => {
        const div = document.createElement("div");
        div.className = "subject";
        div.innerHTML = `<b>${m.nombre}</b><small>${m.codigo}</small>`;
        div.dataset.codigo = m.codigo;

        actualizarEstado(div, m);

        div.onclick = () => {
          if (div.classList.contains("bloqueada")) return;
          const idx = materiasAprobadas.indexOf(m.codigo);
          if (idx > -1) materiasAprobadas.splice(idx, 1);
          else materiasAprobadas.push(m.codigo);
          localStorage.setItem("materiasAprobadas", JSON.stringify(materiasAprobadas));
          refrescarVista();
        };

        col.appendChild(div);
      });
      return col;
    }

    function actualizarEstado(div, materia) {
      if (materiasAprobadas.includes(materia.codigo)) {
        div.classList.add("aprobada");
        div.title = "Aprobada";
      } else if (materia.correlativas.every(c => materiasAprobadas.includes(c))) {
        div.classList.add("disponible");
        div.title = "Disponible";
      } else {
        div.classList.add("bloqueada");
        div.title = `Bloqueada. Correlativas: ${materia.correlativas.join(", ")}`;
      }
    }

    function refrescarVista() {
      const contenedor = document.getElementById("year-1");
      contenedor.innerHTML = "";
      Object.entries(materias1erAnio).forEach(([cuatrimestre, matList]) => {
        contenedor.appendChild(crearColumna(cuatrimestre, matList));
      });
    }

    function reiniciarMalla() {
      localStorage.removeItem("materiasAprobadas");
      materiasAprobadas = [];
      refrescarVista();
    }

    refrescarVista();
  </script>
</body>
</html>
