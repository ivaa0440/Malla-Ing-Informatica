<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Malla Interactiva</title>
  <style>
    body {
      background-color: #121212;
      color: #f0f0f0;
      font-family: sans-serif;
      padding: 1rem;
    }
    h2 {
      margin-top: 2rem;
    }
    .year {
      display: flex;
      flex-direction: column;
      margin-bottom: 2rem;
    }
    .cuatrimestre {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .subject {
      padding: 0.5rem;
      border-radius: 8px;
      min-width: 240px;
      background-color: #1e1e1e;
      cursor: pointer;
      border: 1px solid #444;
      position: relative;
    }
    .subject.aprobada {
      background-color: #4caf50;
      color: white;
      text-decoration: line-through;
    }
    .subject.bloqueada {
      background-color: #555 !important;
      color: #999;
      cursor: not-allowed;
    }
    .subject.locked {
      background-color: #222;
      color: #ccc;
      cursor: not-allowed;
    }
    .subject .codigo {
      font-size: 0.8em;
      display: block;
      opacity: 0.7;
    }
    .tooltip {
      position: absolute;
      bottom: 100%;
      left: 0;
      background: #333;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 0.8em;
      white-space: nowrap;
      opacity: 0;
      transition: opacity 0.2s;
      pointer-events: none;
    }
    .subject:hover .tooltip {
      opacity: 1;
    }
    #reset {
      margin-top: 3rem;
      background-color: #c62828;
      color: white;
      border: none;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      border-radius: 8px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Malla Interactiva - Ingeniería en Informática (UNLaM)</h1>
  <div id="malla"></div>
  <button id="reset">Reiniciar Malla</button>

  <script>
    const materias = [
      { codigo: "901", nombre: "Inglés Transversal Nivel I", año: 0, cuatrimestre: 1, correlativas: [] },
      { codigo: "902", nombre: "Inglés Transversal Nivel II", año: 0, cuatrimestre: 2, correlativas: ["901"] },
      { codigo: "903", nombre: "Inglés Transversal Nivel III", año: 0, cuatrimestre: 3, correlativas: ["902"] },
      { codigo: "911", nombre: "Computación Transversal Nivel I", año: 0, cuatrimestre: 1, correlativas: [] },
      { codigo: "912", nombre: "Computación Transversal Nivel II", año: 0, cuatrimestre: 2, correlativas: ["911"] },
      // Agregá acá todas las materias desde 1er a 5to año copiadas desde la versión anterior
    ];

    const container = document.getElementById("malla");

    const agrupadas = {};
    materias.forEach(m => {
      const key = `${m.año}-${m.cuatrimestre}`;
      if (!agrupadas[key]) agrupadas[key] = [];
      agrupadas[key].push(m);
    });

    const ordenCuatrimestres = Object.keys(agrupadas).sort((a, b) => {
      const [aAño, aCuatri] = a.split("-").map(Number);
      const [bAño, bCuatri] = b.split("-").map(Number);
      return aAño - bAño || aCuatri - bCuatri;
    });

    const estado = JSON.parse(localStorage.getItem("estadoMalla") || "{}");

    ordenCuatrimestres.forEach(key => {
      const [año, cuatri] = key.split("-");
      const materias = agrupadas[key];

      const div = document.createElement("div");
      div.className = "year";

      const h2 = document.createElement("h2");
      h2.textContent = `${año == 0 ? "Transversales" : año + "° Año"} — ${cuatri == 1 ? "1er" : cuatri == 2 ? "2do" : cuatri + "º"} Cuatrimestre`;
      div.appendChild(h2);

      const cuatriDiv = document.createElement("div");
      cuatriDiv.className = "cuatrimestre";

      materias.forEach(mat => {
        const btn = document.createElement("div");
        btn.className = "subject";
        btn.dataset.codigo = mat.codigo;
        btn.innerHTML = `<span class="codigo">${mat.codigo}</span>${mat.nombre}`;

        if (!estado[mat.codigo]) {
          if (mat.correlativas.length === 0) {
            // disponible
          } else if (mat.correlativas.every(c => estado[c])) {
            btn.classList.add("locked"); // desbloqueada pero no aprobada
          } else {
            btn.classList.add("bloqueada");
            const tooltip = document.createElement("div");
            tooltip.className = "tooltip";
            tooltip.textContent = "Correlativas: " + mat.correlativas.join(", ");
            btn.appendChild(tooltip);
          }
        } else {
          btn.classList.add("aprobada");
        }

        btn.addEventListener("click", () => {
          if (btn.classList.contains("bloqueada")) return;

          if (btn.classList.contains("aprobada")) {
            delete estado[mat.codigo];
            btn.classList.remove("aprobada");
          } else {
            estado[mat.codigo] = true;
            btn.classList.add("aprobada");
          }
          localStorage.setItem("estadoMalla", JSON.stringify(estado));
          location.reload();
        });

        cuatriDiv.appendChild(btn);
      });

      div.appendChild(cuatriDiv);
      container.appendChild(div);
    });

    document.getElementById("reset").addEventListener("click", () => {
      const confirmReset = confirm("¿Querés resetear la Malla Interactiva?");
      if (confirmReset) {
        localStorage.removeItem("estadoMalla");
        location.reload();
      }
    });
  </script>
</body>
</html>
